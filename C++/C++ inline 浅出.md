# C++ inline 浅出

> 内联这东西最后还是编译器说的算



精髓评论：

> 在一些语言中，内联函数与编译模型联系紧密：如在C++中，有必要在每个使用它的模块中定义一个内联函数；与之相对应的，普通函数必须定义在单个模块中，这使得模块编译独立于其他的模块。” 而更有参考意义的是[zh.cppreference.com/w/c](http://link.zhihu.com/?target=https%3A//zh.cppreference.com/w/cpp/language/inline) 这里对inline的说明。其一，内联有多种用途，本文没有深入解释。其二，函数内联有一句话就可以说明：“inline 关键词的本意是作为给优化器的指示器，以指示优先采用函数的内联替换而非进行函数调用，即并不执行将控制转移到函数体内的函数调用 CPU 指令，而是代之以执行函数体的一份副本而无需生成调用。这会避免函数调用的开销（传递实参及返回结果），但它可能导致更大的可执行文件，因为函数体必须被复制多次。” 这里其实并没有提及效率问题，而是说避免“传递实参及返回结果”，缺点也很明确“函数体必须被复制多次”



尽管大量的文章都会告诉你inline 函数会让编译器在调用的地方展开，减少函数调用的消耗，会带来代码膨胀问题。但其实这样的解读是不正确的，**inline 并不能一定让函数直接展开，其主要目的也不在于此**。这样的解释会让很多初学者（例如我）认为inline就代表着效率高，而考虑是否应该在所有足够短小的函数前面都添加inline关键词。

Inline的最初目的应该是代替部分 #define 宏定义， 因为宏的编写有很多限制，例如只能写一行，不能使用return控制流程等。Inline的引入是为了解决这些问题

那么inline 关键词是什么意思呢？ 简单来说它就是告诉链接器使用本文件内定义的这个函数即可，不要在往外部找了。

如果理解了C++的编译过程就可以知道 以下的inline 用法都是错误的：

1  在头文件里只声明 inline 函数（非成员） 但是定义在cpp文件里   （这会导致其他文件只引入了声明，在链接的阶段不会去找定义）

**2  直接在cpp文件里 声明+定义 inline 函数,   （基本上没有人会引入 .cpp文件，因此这个函数只能在该文件里使用）**

3  成员函数使用inline 关键词 （默认就是inline, 多余操作）

 

C++ 面向对象的编程思想深入人心，绝大部分情况下我们日常的编程都会使用到类和成员变量的形式，同向对比一下，隔壁的Java已经是完全的面向对象了，要把所有的东西都包含在类里。而类内的成员函数，默认都是 inline的。定义在类声明之中的成员函数将自动地成为内联函数。因此需要显式声明Inline函数的场景就少了许多。



参考资料

https://blog.csdn.net/hang_ning/article/details/109499514

https://zhuanlan.zhihu.com/p/50812510





























