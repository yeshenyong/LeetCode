# 直播推荐算法在腾讯音乐的应用实践

**导读：**直播是社交娱乐app的综合性变现工具，如何培养用户的心智，高效的建立用户和主播的多种连接 ( 点击、观看、关注、常看、常打赏 ) 是直播生态的重要问题之一。为了解决这个问题，各大平台所使用的方法之一是通过个性化推荐系统来促进用户和主播的实时社交。本文主要分享腾讯音乐旗下全民K歌的推荐系统技术及应用。将围绕下面四点展开：

- 业务背景
- 推荐系统架构及挑战
- 召回模型算法设计
- 精排模型算法设计

**01**

**业务背景**

*直播推荐和其他推荐的比较*

![图片](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPjeXM0jsc4jPib4SqvadMX6rslULppUNk5Y3EjiaTbf362RqClr7q9ico8y0I2Yn1gdgjU7145D5GtXw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

直播推荐和内容推荐的对比：它们的相同点是都有一个严格的计划经济，在一个流量池体系下寻找用户和主播/用户和item的相关性；不同点在于直播推荐寻找的是最优的转化率模型，而内容推荐更多的是寻找多目标的融合。直播推荐不仅是有量的要求，而且需要让用户平滑地进入直播间来防止直播间过载（主播接待能力同步）。K歌的直播推荐对比虎牙/YY：场景更大而全，用户的量级更大，用户行为和画像更丰富。而虎牙/YY它们的类目是更丰富的。

**02**

**推荐系统架构**

![图片](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPjeXM0jsc4jPib4SqvadMX6riaibKgXdo2iaWNddl5KSBngxcZmU4CwEn9GlGUicZuhMbdvSuvY0zX5wqg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

在召回这一层面，有索引召回，比如用户喜欢的伴奏来召回直播间。泛社交召回，还有通过好友和用户感兴趣的人所在的直播间来召回。另外，我们对主播有非常严格的价值评估体系，包括实时直播推流去进行视频理解和音频理解，对主播的历史和实时数据的理解等等。

在粗排层，除了需要去考虑一些模型化的问题外，还要考虑一些常看常打赏/关系链这些私域流量，以及用户去消费直播间内容所能感受到的多样性。

对于精排层，主要考虑两个方面：第一个方面是怎么去做更好地交叉；另一个方面是多目标，考虑怎么去设计更好的多目标网络结构和更好的多目标的参数融合。

在重排层，除了对业务的研究之外，还加入了基于行列式的方法这样一些模型来进行多样性重排。

在除了召回、粗排、精排、重排之外，推荐团队依托多个平台支撑，包括：画像、特征、训练、AB test、debug和实时计算平台。

**03**

**召回模型算法设计**

**1. 召回模型迭代**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

从2018年开始做直播推荐，跟随着深度模型的进展，我们的模型迭代了四个阶段，直到工业界的baseline，也就是双塔模型 ( DSSM )。总的方法论就是为用户和item寻找一个共同的空间，并且能够有更全更丰富的表达。此外，如果我们认为DSSM其实是一个single view，还可以有更多的view来辅助主场景，比如我们引入直播间的伴奏信息来进行辅助训练，或者我们加入一些对直播间内容的实时理解。

**2. 召回双塔模型**

![图片](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPjeXM0jsc4jPib4SqvadMX6rn1V3zYhibSfEIhlujdl8Ntzmt83F0GFmuI2IGoDus53PdtZeG434NUw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

为什么DSSM在工业界是一个非常baseline的一个方法呢，以及为什么在这样的框架下能进行非常好的延展呢？第一个方面就是这个模型的表达能力，它的表达能力的上限是非常高的，比起一些传统的方法，比如content-based或者i2i这样的启发式统计模型，它在DNN的框架内，本身就可以享受到主流推荐领域的各种优化。在线上的工程来看，我们只用通过一次请求和快速索引来完成最快速的召回工作。

**3. 召回多模态模型实践**

![图片](https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPjeXM0jsc4jPib4SqvadMX6rae7tPwPYkR3BOq1erLekfJDW2VrStzhgsTj5gYNaYKuIuDziaKzhz8g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

基于这样的召回模型，我们做了怎样的优化呢？我们增加了一个SongView和多媒体的View。我们的思考点是K歌大部分的主播其实是属于唱歌类型的主播，大部分的直播间可能都带着SongID这样一个特征信息，这样的信息是不是能辅助我们对用户进行推荐呢？尤其是K歌直播的许多新用户其实很早以前就是K歌的老用户，他/她对这个Song其实已经有了很多的丰富行为，加了这个信息来作为一个辅助View是不是能够对新用户提升一些效率呢？而且除此之外，我们的兄弟部门QQ音乐，能对这些Song有一个比较好的训练好的embedding来为我们提供支持，加上我们的多媒体库也有很多根据伴奏的一些信息，考虑到以上诸多的优点，我们就尝试了这样一个Multi-view的 DNN，这样的效果在新用户以及整体的点击率上都能够取得一些成绩。进一步思考，直播的本质是我们能够通过理解它的内容来给用户一个更好的推荐，尤其是对一些刚来K歌的用户的第一印象而言，比如对于一个男生来，他会看到这个女生很漂亮，这样一种情况，那么多媒体会给我们一些比较大的帮助。所以我们增加了多媒体这个辅助view能对我们的新用户和点击率有一定的帮助。